window.onload=function(){let f=0;const g=q=>{for(const r of q)r.tests&&(f+=r.tests.length),r.suites&&r.suites.length&&g(r.suites)};g(mocha.suite.suites);const h={build:{test_suite:[{framework:'mocha',formatted_output:{tests:[],pending:[],failures:[],passes:[]}}]}},{formatted_output:i}=h.build.test_suite[0],j=()=>{const q=mocha.run().on('test end',r=>k(r)).on('end',()=>{if(___browserSync___){q.total!==f&&(q.total?console.warn(`${q.total} out of ${f} tests ran.`):console.warn('Make sure the LearnBrowser JS file is loaded *after* the test suite in index.html.')),l(q);const r=m(h,___browserSync___.socketConfig);n(r)}else console.warn('In order to push test data to Learn\'s servers, you must start the test suite from your terminal with the \'learn\' or \'npm test\' command.')})},k=q=>{const r=o(q);switch(i.tests.push(r),!0){case'failed'===q.state:i.failures.push(r);break;case'passed'===q.state:i.passes.push(r);break;case q.pending:i.pending.push(r);}},l=({stats:q})=>{h.examples=f,h.passing_count=q.passes,h.failure_count=q.failures,h.pending_count=q.pending,i.stats=q,h.build.test_suite[0].duration=q},m=(q,{username:r,github_user_id:s,learn_oauth_token:t,repo_name:u,ruby_platform:v,ide_container:w})=>Object.assign({},q,{username:r,github_user_id:s,learn_oauth_token:t,repo_name:u,ruby_platform:v,ide_container:w}),n=q=>fetch('http://ironbroker-v2.flatironschool.com/e/flatiron_mocha',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(q),mode:'no-cors'}).then(()=>{}).catch(()=>console.warn('Unable to contact Learn servers. Please check your Internet connection and try again.')),o=({title:q,parent:r,duration:s,_currentRetry:t,err:u})=>({title:q,fullTitle:p(q,r),duration:s,currentRetry:t,err:u}),p=(q,r)=>{for(;r&&'Suite'===r.constructor.name;)q=r.title.concat(' ',q),r=r.parent;return q.trim()};return()=>j()}();
