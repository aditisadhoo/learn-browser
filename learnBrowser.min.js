window.onload=function(){let a=0;const b=l=>{for(const m of l)m.tests&&(a+=m.tests.length),m.suites&&m.suites.length&&b(m.suites)};b(mocha.suite.suites);const c={build:{test_suite:[{framework:'mocha',formatted_output:{tests:[],pending:[],failures:[],passes:[]}}]}},{formatted_output:d}=c.build.test_suite[0],e=()=>{const l=mocha.run().on('test end',m=>f(m)).on('end',()=>{if(___browserSync___){l.total!==a&&(l.total?console.warn(`${l.total} out of ${a} tests ran.`):console.warn('Make sure the LearnBrowser JS file is loaded *after* the test suite in index.html.')),g(l);const m=h(c,___browserSync___.socketConfig);i(m)}else console.warn('In order to push test data to Learn\'s servers, you must start the test suite from your terminal with the \'learn\' or \'npm test\' command.')})},f=l=>{const m=j(l);switch(d.tests.push(m),!0){case'failed'===l.state:d.failures.push(m);break;case'passed'===l.state:d.passes.push(m);break;case l.pending:d.pending.push(m);}},g=({stats:l})=>{c.examples=a,c.passing_count=l.passes,c.failure_count=l.failures,c.pending_count=l.pending,d.stats=l,c.build.test_suite[0].duration=l},h=(l,{username:m,github_user_id:n,learn_oauth_token:o,repo_name:p,ruby_platform:q,ide_container:r})=>Object.assign({},l,{username:m,github_user_id:n,learn_oauth_token:o,repo_name:p,ruby_platform:q,ide_container:r}),i=l=>fetch('http://ironbroker-v2.flatironschool.com/e/flatiron_mocha',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(l),mode:'no-cors'}).then(()=>{}).catch(()=>console.warn('Unable to contact Learn servers. Please check your Internet connection and try again.')),j=({title:l,parent:m,duration:n,_currentRetry:o,err:p})=>({title:l,fullTitle:k(l,m),duration:n,currentRetry:o,err:p}),k=(l,m)=>{for(;m&&'Suite'===m.constructor.name;)l=m.title.concat(' ',l),m=m.parent;return l.trim()};return()=>e()}();
